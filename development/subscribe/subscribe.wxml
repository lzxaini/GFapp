<view class="device-use_container">
  <t-navbar t-class="navBar" left-arrow bind:go-back="goPage" title="设备订阅"></t-navbar>
  <scroll-view class="message" scroll-y="true" scroll-into-view="{{scrollToView}}" scroll-with-animation="true">
    <view class="msg-container">
      <block wx:for="{{messages}}" wx:key="id">
        <view id="{{item.id}}" class="msg-wrapper {{item.type === 'send' ? 'msg-send' : 'msg-receive'}}">
          <view class="msg-bubble">
            <view class="msg-text">{{item.text}}</view>
            <view class="msg-time" wx:if="{{item.type === 'receive'}}">
              <text>{{item.time}} 收</text>
              <t-icon class="hexBtn" name="arrow-left-right-circle" bindtap="hexToString" data-item="{{item}}" size="18" color="#67C23A" />
            </view>
            <view class="msg-time" wx:else>
              <text>{{item.time}} 发</text>
              <t-icon class="hexBtn" name="arrow-left-right-circle" bindtap="hexToString" data-item="{{item}}" size="18" color="#67C23A" />
            </view>
          </view>
        </view>
      </block>
    </view>
  </scroll-view>
  <view class="send_msg" style="padding-bottom: {{marginBottom}}">
    <!-- 展开/收起按钮 -->
    <view class="menu-toggle" bindtap="toggleMenu">
      <text>快捷指令</text>
      <view style="display: flex;">
        <t-button t-class="switch_btn" size="extra-small" theme="primary" bindtap="toggleSendType" wx:if="{{sendType === 'HEX'}}" data-type="String">{{btnText}}</t-button>
        <t-button size="extra-small" theme="primary" bindtap="toggleSendType" wx:else data-type="HEX">{{btnText}}</t-button>
        <t-icon style="margin-left: 30rpx;" name="{{menuExpanded ? 'chevron-up' : 'chevron-down'}}" size="20" />
      </view>
    </view>

    <!-- 快捷指令菜单 -->
    <view class="menu {{menuExpanded ? 'menu-expanded' : 'menu-collapsed'}}">
      <!-- 设备通用指令 -->
      <view class="menu-section">
        <view class="section-title">📱 设备指令</view>
        <view class="section-buttons">
          <t-button size="extra-small" theme="light" bindtap="send" data-type="scan">发送扫码</t-button>
          <t-button size="extra-small" bindtap="send" data-type="end">发送结束</t-button>
          <t-button size="extra-small" theme="success" bindtap="sendCommand" data-cmd="config-get">获取配置</t-button>
          <t-button size="extra-small" theme="danger" bindtap="sendCommand" data-cmd="network-reset">重置配网</t-button>
        </view>
      </view>
      
      <!-- 4G模块AT指令 -->
      <view class="menu-section">
        <view class="section-title">📡 4G模块指令</view>
        <view class="section-buttons">
          <t-button size="extra-small" theme="info" bindtap="sendCommand" data-cmd="AT+IMEI">📱 IMEI</t-button>
          <t-button size="extra-small" theme="primary" bindtap="sendCommand" data-cmd="AT+CSQ">📶 信号</t-button>
          <t-button size="extra-small" theme="success" bindtap="sendCommand" data-cmd="AT+UTC">⏰ 时间</t-button>
          <t-button size="extra-small" theme="warning" bindtap="sendCommand" data-cmd="AT+LBS">📍 定位</t-button>
          <t-button size="extra-small" theme="info" bindtap="sendCommand" data-cmd="AT+ISLINK">🌐 网络</t-button>
          <t-button size="extra-small" theme="info" bindtap="sendCommand" data-cmd="AT+CEREG">📡 注册</t-button>
          <t-button size="extra-small" theme="danger" bindtap="sendCommand" data-cmd="AT+RESET">🔄 重启</t-button>
        </view>
      </view>
    </view>
    <view class="input-area">
      <input class="msg-input" placeholder="输入消息..." value="{{inputText}}" bindinput="onInputChange" confirm-type="send" bindconfirm="sendMessage" />
      <button class="send-btn" bindtap="sendMessage">发送</button>
    </view>
    <view class="device_info">
      <text>设备ID：{{deviceId}}</text>
      <button class="btn_clear" bindtap="clearLog">清空日志</button>
    </view>
  </view>
</view>
<t-message id="t-message" />